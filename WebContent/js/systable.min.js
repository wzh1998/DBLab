/* SYSUI-SYSTABLE 2019-01-10 version2.0 799129700@qq.com SYSHUXL-化海天堂 by www.husysui.com Reserved head available commercial use Universal background system interface framework */
function extend(o,n,override){for(var key in n){if(n.hasOwnProperty(key)&&(!o.hasOwnProperty(key)||override)){o[key]=n[key]}}return o};function addLoadListener(fn){if(typeof window.addEventListener!='undefined'){window.addEventListener('load',fn,false)}else if(typeof document.addEventListener!='undefined'){document.addEventListener('load',fn,false)}else if(typeof window.attachEvent!='undefined'){window.attachEvent('onload',fn)}else{var oldfn=window.onload;if(typeof window.onload!='function'){window.onload=fn}else{window.onload=function(){oldfn();fn()}}}};function TAB$(i){return document.getElementById(i)};function TABLAYER$(i){return document.createElement(i)};function name$(i){return document.getElementsByName(i)}function tagname$(i){return document.getElementsByTagName(i)}function SYSTableSorter(options){this._initial(options)};SYSTableSorter.prototype={constructor:this,_initial:function(options){var par={TableName:'',btnArea:'',paginName:'',edit:'',curPage:1,Sequence:[],RightClick:false,template:true,btnpageing:5,mode:'table',setItem:'',loading:'<div class="loading"><div><img src="../style/images/timg.gif" class="load-img"/></div>加载中请稍等</div>',ErrorMessage:'操作失败，请稍后再试！',SuccessPrompt:'操作成功！',timeFormat:'',pageSize:[10,20,30],ViewState:[],sessionArr:[],Callback:function(){},DeleteEvent:function(){},ModifyEvent:function(){},DetailedEvent:function(){},SaveEvent:function(){},CheckboxDeleteEvent:function(){},SearchEvent:function(){}};this.par=extend(par,options,true);this.hasClass=function(elements,cName){return!!elements.className.match(new RegExp("(\\s|^)"+cName+"(\\s|$)"))};this.addClass=function(elements,cName){if(!this.hasClass(elements,cName)){elements.className+=" "+cName}};this.removeClass=function(elements,cName){if(this.hasClass(elements,cName)){elements.className=elements.className.replace(new RegExp("(\\s|^)"+cName+"(\\s|$)")," ");}};this.getByClass=function(oParent,sClass){var oReasult=[];var oEle=oParent.getElementsByTagName("*");for(i=0;i<oEle.length;i+=1){if(oEle[i].className==sClass){oReasult.push(oEle[i])}};return oReasult};this.show(this.par)},show:function(callback){var _this=this;var Table=TAB$(callback.TableName);var other=TAB$(callback.btnArea);var mode=callback.mode;var args=callback.Sequence;if(mode=="table"){for(var x=0;x<Table.rows[0].cells.length;x+=1){callback.ViewState[x]=false};if(args!=null){if(args.length>1){for(var x=1;x<args.length;x+=1){if(args[x]>Table.rows[0].cells.length){continue}else{var newDiv=TABLAYER$("em");_this.addClass(newDiv,'NormalCss');Table.rows[0].cells[args[x]].appendChild(newDiv);Table.rows[0].cells[args[x]].onclick=function(){for(var m=1;m<args.length;m+=1){_this.onSequence(Table,args[m])}};Table.rows[0].cells[args[x]].style.cursor="pointer"}}}};var tTD;for(var x=0;x<Table.rows[0].cells.length;x+=1){var checkbox=Table.rows[0].cells[x].getElementsByTagName('input')[x];checkbox?Table.rows[0].cells[x].onclick=function(e){for(var m=0;m<Table.rows[0].cells.length;m+=1){_this.oncheckbox(Table,m)}}:'';Table.rows[0].cells[x].onmousedown=function(e){_this.Dragdrop(e,Table,tTD,this)};Table.rows[0].cells[x].onmouseup=function(e){_this.onmouseupDrop(e,Table,tTD,this)};Table.rows[0].cells[x].onmousemove=function(e){_this.onmousemoveDrop(e,Table,tTD,this)}}}_this.callbackf(Table,_this,other);if(callback.RightClick==true){document.oncontextmenu=function(e){e.preventDefault();e.stopPropagation()}};_this.sessionArrhtml(Table)},currentcheckbox:function(Table,index){for(var x=1;x<Table.rows.length;x+=1){var checkbox=Table.rows[x].cells[0].getElementsByTagName('input')[0];checkbox?Table.rows[x].cells[0].onclick=function(){for(var m=1;m<Table.rows.length;m+=1){index.onlikecheck(Table,m)}}:'';}},callbackf:function(Table,obj,other){var size=obj.par.pageSize;var pageSize=size[0];var curPage=obj.par.curPage;obj.par.Callback(Table,obj,curPage,pageSize);obj.ajaxObject(obj);obj.Selectedbtnmethod(other,Table,obj,curPage,pageSize)},PromptBox:function(texts,time,status){var _this=this;var b=document.body.querySelector(".box_Bullet");if(!b){var box=document.createElement("div");document.body.appendChild(box).className="box_Bullet";var boxcss=document.querySelector(".box_Bullet");var winWidth=window.innerWidth;document.body.appendChild(box).innerHTML=texts;var wblank=winWidth-boxcss.offsetWidth;box.style.cssText="width:"+boxcss.offsetWidth+"px; left:"+(wblank/2)+"px;margin-top:"+(-boxcss.offsetHeight/2)+"px";var int=setInterval(function(){time-=1;_this.endclearInterval(time,box,int)},1000)}else if(status==true){document.body.removeChild(b);return}},endclearInterval:function(time,box,int){time>0?time-- :clearInterval(int);if(time==0){clearInterval(int);document.body.removeChild(box);return}},ajaxObject:function(obj){var xmlHttp;try{xmlHttp=new XMLHttpRequest()}catch(e){try{xmlHttp=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{xmlHttp=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){obj.PromptBox('您的浏览器不支持AJAX',2,false);return false}}}return xmlHttp},ajaxGet:function(url,success,curPage,pageSize){var _this=this;var template=_this.par.template;var start=0,end=0;var Table=TAB$(_this.par.TableName);var ajax=_this.ajaxObject();ajax.open("get",url,true);if(ajax){_this.PromptBox(_this.par.loading,0,true)}ajax.onreadystatechange=function(){if(ajax.readyState==4){if(ajax.status==200){var json=ajax.responseText;if(json=="202"){_this.PromptBox(_this.par.SuccessPrompt,2,false);_this.par.Callback(Table,_this,curPage,pageSize);_this.PromptBox(_this.par.SuccessPrompt,0,true);return}else if(json=="101"){_this.PromptBox(_this.par.ErrorMessage,2,false);_this.PromptBox(null,0,true);return}else{var jsonStr=JSON.parse(json);if(template==true){_this.contenthtml(Table,jsonStr,_this,curPage,pageSize)}else{success(jsonStr)}_this.PromptBox(null,0,true);return}}else{_this.PromptBox("HTTP请求错误！错误码："+ajax.status,2,false)}}};ajax.send()},ajaxPost:function(url,data,evnet,layer){var _this=this;var ajax=_this.ajaxObject();ajax.open("post",url,true);ajax.setRequestHeader("Content-Type","application/x-www-form-urlencoded");ajax.onreadystatechange=function(){if(ajax.readyState==4){if(ajax.status==200){_this.statusname(ajax.responseText,_this,evnet,layer)}else{_this.PromptBox("HTTP请求错误！错误码："+ajax.status,2,false);return}}else{return}};typeof(data)!="undefined"?ajax.send(data):''},statusname:function(status,set,evnet,layer){if(evnet.name=="SaveEvent"){if(status=="101"){set.PromptBox(set.par.ErrorMessage,2,false)}else if(status=="202"){set.PromptBox(set.par.SuccessPrompt,2);var edit=set.getByClass(layer.parentNode,'table-edit');for(var i=0;i<edit.length;i+=1){var text=edit[i].getElementsByTagName("input")[0].value;var muster=_this.getByClass(edit[i],'radio');if(muster!=0){for(var c=0;c<muster.length;c+=1){var n=muster[c].getElementsByTagName("input")[0].getAttribute("data-name");if(muster[c].getElementsByTagName("input")[0].checked==true){var text=n}}}edit[i].innerHTML=text}evnet.innerText="修改";evnet.name='modifyEvent'}}else{if(status=="101"){set.PromptBox(set.par.ErrorMessage,2,false)}else if(status=="202"){set.PromptBox(set.par.SuccessPrompt,2,false)}}},sessionArrhtml:function(Table){_this=this;var list,edit=TAB$(_this.par.edit);edit?list=TAB$(_this.par.edit):list=Table.getElementsByTagName('tbody')[0];var rota=_this.par.setItem;var sessionArr=_this.par.sessionArr;var obj={html:list.innerHTML};sessionArr.push(obj);var html=JSON.stringify(sessionArr);window.sessionStorage.setItem(rota,html);},contenthtml:function(Table,jsonStr,_this,curPage,pageSize){var nameedit,edit=TAB$(_this.par.edit);edit?nameedit=TAB$(_this.par.edit):nameedit=Table.getElementsByTagName('tbody')[0];var total=parseInt(jsonStr.total);var pageTotal=Math.ceil(total/pageSize);var rota=_this.par.setItem;var mode=_this.par.mode;var menu=JSON.parse(window.sessionStorage.getItem(rota));if(jsonStr.data!=null){var s=navigator.userAgent.toLowerCase();var BrowserInfo={IsIE:false,IsIE9Under:false&&(parseInt(s.match(/msie (\d+)/)[1],10)<=9)};if(BrowserInfo.IsIE9Under){nameedit.appendChild=menu[0].html;}else{nameedit.innerHTML=menu[0].html;}var amount=jsonStr.data.length;for(var i=0;i<amount;i+=1){var Array=jsonStr.data[i];if(mode=="ul"){var rows=nameedit.getElementsByTagName("ul");var clonedNode=nameedit.children[i].cloneNode(true);nameedit.appendChild(clonedNode);var tds=rows[i].getElementsByTagName("li");for(var x=0;x<tds.length;x+=1){var Child=tds[x];_this.stencil(nameedit,rows,jsonStr,tds.length,Array,i,Child,x)}}else if(mode=="table"){var rows=nameedit.children;if(BrowserInfo.IsIE9Under){var clonedNode=rows[0].cloneNode(true);nameedit.appendChild(clonedNode);var cells=nameedit.rows[0].children;var tds=cells.length;for(var x=0;x<tds;x+=1){var Child=cells[x];_this.stencil(nameedit,rows,jsonStr,tds,Array,i,Child,x,BrowserInfo)}}else{var clonedNode=nameedit.rows[i].cloneNode(true);nameedit.appendChild(clonedNode);var tds=nameedit.rows[i].cells.length;for(var x=0;x<tds;x+=1){var Child=nameedit.rows[i].cells[x];_this.stencil(nameedit,rows,jsonStr,tds,Array,i,Child,x,BrowserInfo)}}}}if(mode=="ul"){var Child=nameedit.children[amount];nameedit.removeChild(Child);if(amount!=(nameedit.children.length)){var ms=nameedit.children.length;for(var a=ms-1;a>=amount;a-=1){nameedit.children[a].remove()}}}else if(mode=="table"){var rows=nameedit.getElementsByTagName("tr");var Child=nameedit.rows[amount];nameedit.removeChild(Child);if(amount!=(nameedit.rows.length)){var ms=nameedit.rows.length;for(var a=ms-1;a>=amount;a-=1){nameedit.rows[a].remove()}}_this.BtnoperationMethod(Table,_this,curPage,pageSize)}}else{if(mode=="ul"){nameedit.innerHTML='<span class="prompt padding15">暂时还没有相关内容</span>'}else if(mode=="table"){var tds=nameedit.rows[0].cells.length;nameedit.innerHTML='<td colspan="'+tds+'">暂时还没有相关内容</td>'}}_this.pageTableMethod(null,curPage,pageTotal,pageSize,total)},stencil:function(nameedit,rows,jsonStr,tds,Array,i,Child,x,BrowserInfo){var _this=this;var keyvalue=Child.getAttribute("data-value");var formatname=Child.getAttribute("data-format");var defaults=Child.getAttribute("data-default");var btn=Child.getAttribute("data-button");if(formatname=='time'){var format=_this.par.timeFormat;var dates=Array[keyvalue];var value=_this.formatDate(format,dates)}else if(formatname=='checkbox'){var ArrayString=Child.getAttribute("data-Array");if(ArrayString){var result=ArrayString.split(",");var newarr=[];for(var n=0;n<result.length;n+=1){var newgroup={id:n,cname:result[n]};newarr.push(newgroup);}for(var c=0;c<newarr.length;c+=1){if(Array[keyvalue]==newarr[c].id){var value=newarr[c].cname}else{Child.innerHTML="无"}}}else{var value="<label class='checkbox radio'><input name='checkbox' data-name='checkbox'  type='checkbox' value='"+Array[keyvalue]+"' class='ace'><span class='lbl'></span></label>"}}else if(formatname=="img"){var formatname=Child.getAttribute("data-Array");var value="<img src='"+formatname+Array[keyvalue]+"' class='imgset'/>"}else{var value=Array[keyvalue]}if(btn=="btn"){if(x==(tds-1)){if(BrowserInfo.IsIE9Under){var s=nameedit.rows[0].children[tds-1]}else{var s=nameedit.rows[i].cells[tds-1]}var btn=s.getElementsByTagName("button")||s.getElementsByTagName("a");for(var b=0;b<btn.length;b+=1){var atr=document.createAttribute("data-id");atr.nodeValue=value;btn[b].setAttributeNode(atr)}}}else{if(keyvalue){Array[keyvalue]?Child.innerHTML=value:Child.innerHTML="无"}}},formatDate:function(format,date){if(typeof date==="string"){var mts=date.match(/(\/Date(\d+)\/)/);if(mts&&mts.length>=3){date=parseInt(mts[2])}}date=new Date(parseInt(date*1000));if(!date||date.toUTCString()=="Invalid Date"){return ""}var map={"M":date.getMonth()+1,"d":date.getDate(),"h":date.getHours(),"m":date.getMinutes(),"s":date.getSeconds(),"q":Math.floor((date.getMonth()+3)/3),"S":date.getMilliseconds()};format=format.replace(/([yMdhmsqS])+/g,function(all,t){var v=map[t];if(v!==undefined){if(all.length>1){v='0'+v;v=v.substr(v.length-2)}return v}else if(t==='y'){return(date.getFullYear()+'').substr(4-all.length)}return all});return format},Selectedbtnmethod:function(other,Table,obj,curPage,pageSize){if(other){var btn=other.getElementsByTagName("a")||other.getElementsByTagName("button");for(var i=0;i<btn.length;i+=1){btn[i].onclick=function(e){var Table=TAB$(obj.par.TableName);if(this.name=="DeleteCheckbox"){var checkbox=name$('checkbox');var trm=Table.rows.length;var batchDelete="";for(var x=Table.rows.length-1;x>=1;x-=1){if(checkbox[x].checked==true){var id=checkbox[x].value;var keyname=checkbox[x].getAttribute("data-name");batchDelete+=id+",";var remove=checkbox[x].parentNode.parentNode.parentNode;var trm=Table.rows.length-1}};if(Table.rows.length==trm){obj.PromptBox("请选择你要删除的信息！",2,false)}else{batchDelete=batchDelete.substring(0,batchDelete.lastIndexOf(','));obj.par.CheckboxDeleteEvent(obj,batchDelete,curPage,pageSize)}}else if(this.name=="searchEvent"){var value=this.parentNode.getElementsByTagName('input')[0].value;if(value){obj.par.SearchEvent(obj,value,curPage,pageSize)}else{obj.PromptBox("请输入查询关键字！",2,false)}}else if(this.name=="RefreshEvent"){obj.par.Callback(Table,obj,curPage,pageSize)}else if(this.name=="ExcelEvent"){var name=this.getAttribute("data-name");var Table=obj.par.TableName;var idTmr;var explorer=obj.BrowserSpot(explorer);if(explorer=="ie"){var oXL=new ActiveXObject("Excel.Application");var oWB=oXL.Workbooks.Add();var xlsheet=oWB.Worksheets(1);var sel=document.body.createTextRange();sel.moveToElementText(Table);sel.select();sel.execCommand("Copy");xlsheet.Paste();oXL.Visible=true;try{var fname=oXL.Application.GetSaveAsFilename("Excel.xls","Excel Spreadsheets (*.xls), *.xls")}catch(e){print("Nested catch caught "+e)}finally{oWB.SaveAs(fname);oWB.Close(savechanges=false);oXL.Quit();oXL=null;idTmr=window.setInterval(obj.Cleanup(),1)}}else{obj.tableToExcel(Table,name,obj)}}}}}},ExcelHTML:function(html){var _table=this;var list=TAB$(_table.par.TableName);var newtable;newtable=TABLAYER$('table');newtable.id='Newtable';document.body.appendChild(newtable);newtable.style.cssText="display:none;";var copy=list.innerHTML;newtable.innerHTML=copy;for(var x=1;x<newtable.rows.length;x+=1){var z=newtable.rows[x].cells.length;newtable.rows[x].cells[z-1].remove();newtable.rows[x].cells[0].remove()}var z=newtable.rows[0].cells.length;newtable.rows[0].cells[z-1].remove();newtable.rows[0].cells[0].remove();var html=newtable.innerHTML;return html;},tableToExcel:function(table,name,obj){var html=obj.ExcelHTML(html);var uri='data:application/vnd.ms-excel;base64,',template='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel"xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--> <style type="text/css">.table{ border-collapse:collapse; border:thin solid #999; }.table_striped thead th{color: #707070; background: #f2f2f2;background-image: -webkit-gradient(linear,left 0,left 100%,from(#f8f8f8),to(#ececec));background-image: -webkit-linear-gradient(top,#f8f8f8,0%,#ececec,100%);background-image: -moz-linear-gradient(top,#f8f8f8 0,#ececec 100%);background-image: linear-gradient(to bottom,#f8f8f8 0,#ececec 100%);background-repeat: repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr="#fff8f8f8",endColorstr="#ffececec",GradientType=0); } .table td{  border:thin solid #999;  padding:2px 5px;  text-align: center; }</style></head><body ><table class="gallery table table_list table_striped table-bordered border">{table}</table></body></html>',base64=function(s){return window.btoa(unescape(encodeURIComponent(s)))},format=function(s,c){return s.replace(/{(\w+)}/g,function(m,p){return c[p]})};if(!table.nodeType){table=document.getElementById(table)}var ctx={worksheet:name||'Worksheet',table:html};window.location.href=uri+base64(format(template,ctx));TAB$("Newtable").remove()},Cleanup:function(){window.clearInterval(idTmr);CollectGarbage()},BrowserSpot:function(explorer){var explorer=window.navigator.userAgent;if(explorer.indexOf("MSIE")>=0){return 'ie'}else if(explorer.indexOf("Firefox")>=0){return 'Firefox'}else if(explorer.indexOf("Chrome")>=0){return 'Chrome'}else if(explorer.indexOf("Opera")>=0){return 'Opera'}else if(explorer.indexOf("Safari")>=0){return 'Safari'}return explorer},BtnoperationMethod:function(Table,obj,curPage,pageSize){for(var x=1;x<Table.rows.length;x+=1){for(var c=1;c<Table.rows[x].cells.length;c+=1){var btn=Table.rows[x].cells[c].getElementsByTagName("button")||Table.rows[x].cells[c].getElementsByTagName("a");Table.rows[x].cells[c].onclick=function(e){var evt=e||window.event;var tar=evt.target||evt.srcElement;if(tar.tagName.toLowerCase()=="button"||tar.tagName.toLowerCase()=="a"){var name=tar.name;var id=tar.getAttribute("data-id");addLoadListener(obj.btnclick);obj.btnclick(Table,id,this,name,tar,curPage,pageSize)}}}}},btnclick:function(Table,id,obj,name,e,curPage,pageSize){var _this=this;if(name=='deleteEvent'){_this.par.DeleteEvent(obj,_this,id,curPage,pageSize);return}else if(name=='modifyEvent'){_this.ModifyMethod(Table,id,obj,name,e);_this.par.ModifyEvent(obj,_this,id);return}else if(name=='detailedEvent'){_this.par.DetailedEvent(obj,_this,id);return}else if(name=='SaveEvent'){_this.SaveMethod(Table,id,obj,_this,e)}},ModifyMethod:function(Table,id,obj,name,e){var _this=this;var edit=_this.getByClass(obj.parentNode,'table-edit');if(edit!=0){for(var i=0;i<edit.length;i+=1){var keyvalue=edit[i].getAttribute("data-value");var keyname=edit[i].getAttribute("data-name");var ArrayString=edit[i].getAttribute("data-Array");var text=edit[i].innerText;if(keyname=="checkbox"){edit[i].innerHTML="";var result=ArrayString.split(",");var newarr=[];for(var n=0;n<result.length;n+=1){var newgroup={id:n,name:result[n]};newarr.push(newgroup);}for(var c=0;c<newarr.length;c+=1){if(text==newarr[c].name){edit[i].innerHTML+="<label class='radio'><input name='"+keyvalue+"' type='radio' checked='checked' data-name='"+newarr[c].name+"' value='"+c+"' class='ace'><span class='lbl'>"+newarr[c].name+"</span></label>"}else{edit[i].innerHTML+="<label class='radio'><input name='"+keyvalue+"' data-name='"+newarr[c].name+"'  type='radio' value='"+c+"' class='ace'><span class='lbl'>"+newarr[c].name+"</span></label>"}}}else{edit[i].innerHTML="<input type='text' class='edit-text' value='"+text+"' name='"+keyvalue+"' />"}}e.innerText="保存";e.name='SaveEvent'}else{_this.PromptBox("抱歉，不支持直接修改信息，请点击详细进行操作",2,false)}},SaveMethod:function(Table,id,obj,_this,e){var formData="";var m=obj.parentNode.getElementsByTagName('td');for(var i=0;i<m.length;i+=1){var edit=_this.hasClass(m[i],'table-edit');if(edit){var keyvalue=m[i].getAttribute("data-value");var keyname=m[i].getElementsByTagName("input")[0].name;var muster=_this.getByClass(m[i],'radio');if(muster!=0){for(var c=0;c<muster.length;c+=1){var checkedname=name$(keyvalue)[c];if(checkedname.checked==true){var text=name$(keyvalue)[c].value}}}else{var text=m[i].getElementsByTagName("input")[0].value}formData+=keyname+"="+text+"&";if(text==""){_this.PromptBox("修改信息内容不能为空",2,false);return false}}}_this.par.SaveEvent(obj,_this,id,formData,e);},pageTableMethod:function(html,curPage,pageTotal,pageSize,total){var that=this;var Table=TAB$(that.par.TableName);var amount=that.par.btnpageing;var pagination=TAB$(that.par.paginName);pageTotal==0?pageTotal=1:'';if(pagination){var number=name$('page-number')[0];if(number){var ul=number.parentNode;var pag=[];var modern=[];var pagset=[];var number=name$('page-number');var sets=that.par.pageSize;for(var i=0;i<number.length;i+=1){var pages=parseInt(number[i].getAttribute("data-pages"));modern.push(pages)}if(curPage<pageSize){var ellipsis=number[0].parentNode.getElementsByTagName('span')[0];var jh=Math.min(pageSize,pageTotal);while(jh){pag.unshift(jh--)}for(var s=0;s<sets.length;s+=1){var current;total==0?current=1:current=0;set=Math.ceil((total+current)/sets[s]);if(pageTotal<=set){ellipsis?ellipsis.remove():'';for(var i=number.length-1;i>=0;i-=1){pag[i]!=modern[i]?number[i].remove():''}var next=name$('Next-page')[0];that.nextPage(ul,curPage,pageTotal,html,next)}}for(var i=0;i<pag.length;i+=1){if(number.length<=amount){if(pag[i]==modern[i]){number[i].setAttribute("data-pages",pag[i]);number[i].innerHTML=pag[i];var ys=parseInt(number[i].innerHTML);if(ys==curPage){that.addClass(number[i],'active')}else{that.removeClass(number[i],'active')}}else{var li=TABLAYER$('li');var atr=document.createAttribute("name");atr.nodeValue="page-number";li.setAttributeNode(atr);var pages=document.createAttribute("data-pages");pages.nodeValue=pag[i];li.setAttributeNode(pages);li.innerHTML=pag[i];number[0].parentNode.appendChild(li)}}else{number[i].setAttribute("data-pages",pag[i]);number[i].innerHTML=pag[i];var ys=parseInt(number[i].innerHTML);if(ys==curPage){that.addClass(number[i],'active')}else{that.removeClass(number[i],'active')}}}if(number.length>=amount){if(!ellipsis){var span=TABLAYER$('span');that.addClass(span,'ellipsis');span.innerHTML='...';number[0].parentNode.appendChild(span);var next=TABLAYER$('li');var atr=document.createAttribute("name");atr.nodeValue="page-number";next.setAttributeNode(atr);var pages=document.createAttribute("data-pages");pages.nodeValue=pageTotal;next.setAttributeNode(pages);next.innerHTML=pageTotal;that.removeClass(next,'pages');that.addClass(next,'mantissa');number[0].parentNode.appendChild(next)}}for(var i=0;i<number.length-1;i+=1){var size=number[i].getAttribute('data-pages');for(var j=i+1;j<number.length;j+=1){var contrast=number[j].getAttribute('data-pages');if(size==contrast){number[i].remove()}}}}else{if(pageTotal-curPage>1){var middle=(curPage-1)-Math.floor(pageSize/2),i=pageSize;if(middle>pageTotal-pageSize){middle=pageTotal-pageSize+1}while(i--){pag.push(middle++)}for(var i=0;i<number.length-1;i+=1){var ellipsis=number[i].parentNode.getElementsByTagName('span')[0];ellipsis?ellipsis.remove():'';var pages=parseInt(number[i].getAttribute("data-pages"));number[i].setAttribute("data-pages",pag[i]);number[i].innerHTML=pag[i];var ys=parseInt(number[i].innerHTML);if(ys==curPage){that.addClass(number[i],'active')}else{that.removeClass(number[i],'active')}}}else{return}}}else{that.firstPage(ul,curPage,html,pageTotal,pagination,pageSize);that.lastPage(ul,curPage,html,null,pagination,pageSize);var ul=pagination.appendChild(TABLAYER$('ul'));that.addClass(ul,'Page-library');for(var p=0;p<pageTotal;p+=1){var li=TABLAYER$('li');var atr=document.createAttribute("name");atr.nodeValue="page-number";li.setAttributeNode(atr);if(p==curPage-1){li.className+=' active'}else{that.addClass(li,'pages');that.getPage(curPage)}li.innerHTML=p+1;var pages=document.createAttribute("data-pages");pages.nodeValue=p+1;li.setAttributeNode(pages);ul.appendChild(li)};var number=name$('page-number');for(var i=0;i<number.length;i+=1){for(var e=amount;e<number.length;e+=1){if(number.length==pageTotal){var span=TABLAYER$('span');that.addClass(span,'ellipsis');span.innerHTML='...';ul.appendChild(span)}number[e].remove();li.innerHTML=pageTotal;that.removeClass(li,'pages');that.addClass(li,'mantissa');ul.appendChild(li)}};that.nextPage(ul,curPage,pageTotal,html);that.finalPage(ul,curPage,pageTotal,html)}that.showPageTotal(ul,curPage,pageTotal,total,Table);for(var i=0;i<number.length;i+=1){if(number){number[i].index=i;addLoadListener(that.pageonclick(number[i],number,number.parentNode,number[i],curPage,pageTotal,pageSize,that,html,Table))}}}},pageonclick:function(event,number,ul,li,curPage,pageTotal,pageSize,obj,html,Table){event.onclick=function(e){for(var n=0;n<number.length;n+=1){var classname=obj.hasClass(li,'mantissa');if(classname){var u=parseInt(li.getAttribute("data-pages"))}index=e.target.index;var curPage=parseInt(number[index].getAttribute("data-pages"));var ym=parseInt(number[n].getAttribute("data-pages"));if(ym==curPage){obj.addClass(number[n],'active')}else{obj.removeClass(number[n],'active')}if(u-curPage>1){obj.getPages(ul,curPage,pageTotal,pageSize)}}obj.par.Callback(Table,obj,curPage,pageSize);var Pre=name$('Pre-page')[0];obj.lastPage(ul,curPage,html,Pre);var next=name$('Next-page')[0];obj.nextPage(ul,curPage,pageTotal,html,next);}},getPage:function(page){},firstPage:function(ul,curPage,html,pageTotal,pagination){var that=this;var Table=TAB$(that.par.TableName);var span=TABLAYER$('span');var size=that.par.pageSize;var pageSize=size[0];span.innerHTML='首页';pagination.appendChild(span);span.onclick=function(){var val=parseInt(1);curPage=val;that.getPage(that.curPage);that.par.Callback(Table,that,curPage,pageSize);that.addClass(span,'active');var last=name$('last-page')[0];that.removeClass(last,'active');var Pre=name$('Pre-page')[0];that.lastPage(ul,curPage,html,Pre);var next=name$('Next-page')[0];that.nextPage(ul,curPage,pageTotal,html,next);};var atr=document.createAttribute("name");atr.nodeValue="home-page";pagination.setAttributeNode(atr)},lastPage:function(ul,curPage,html,obj,pagination){var that=this;var size=that.par.pageSize;var pageSize=size[0];var Table=TAB$(that.par.TableName);var number=name$('page-number');var span=TABLAYER$('span');if(!obj){span.innerHTML='<';if(parseInt(curPage)==1){span.className='disabled'}var atr=document.createAttribute("name");atr.nodeValue="Pre-page";span.setAttributeNode(atr);pagination.appendChild(span)}else{if(parseInt(curPage)>1){obj.onclick=function(){curPage=parseInt(curPage-1);if(curPage>0){that.par.Callback(Table,that,curPage,pageSize);that.getPage(that.curPage)}if(curPage==1){that.addClass(obj,'disabled')}};that.removeClass(obj,'disabled')}else{for(var i=0;i<number.length;i+=1){var lastm=parseInt(number[i].getAttribute("data-pages"));if(curPage!=lastm){that.removeClass(number[i],'active')}}that.addClass(obj,'disabled')}}},getPages:function(ul,curPage,pageTotal,pageSize){var pag=[];var that=this;if(curPage<=pageTotal){if(curPage<pageSize){var i=Math.min(pageSize,pageTotal);while(i){pag.unshift(i--)}}else{var middle=curPage-Math.floor(pageSize/2),i=pageSize;if(middle>pageTotal-pageSize){middle=pageTotal-pageSize+1}while(i--){pag.push(middle++)}}}else{that.PromptBox("当前页数不能大于总页数",2)}if(!pageSize){that.PromptBox("显示页数不能为空或者0",2)}return pag},Pagination:function(ul,pag,pageTotal,that){var number=name$('page-number');var pagination=TAB$(that.par.paginName);for(var i=0;i<number.length-1;i+=1){var li=TABLAYER$('li');number[i].innerHTML=pag[i];ul.appendChild(li);var m=pageTotal-1;if(pag[i]==m){}}},nextPage:function(ul,curPage,pageTotal,html,obj){var that=this;var Table=TAB$(that.par.TableName);var span=TABLAYER$('span');var number=name$('page-number');var size=that.par.pageSize;var pageSize=size[0];if(!obj){span.innerHTML='>';if(parseInt(curPage)<parseInt(pageTotal)){span.onclick=function(){for(var i=0;i<number.length-1;i+=1){var active=that.hasClass(number[i],'active');if(active){var curPage=parseInt(number[i].getAttribute("data-pages"))}}curPage=parseInt(curPage+1);if(curPage>=pageTotal-1){span.className='disabled'}else{that.par.Callback(Table,that,curPage,pageSize);that.getPage(that.curPage);var Pre=name$('Pre-page')[0];that.removeClass(Pre,'disabled')}}}else{span.className='disabled'}var atr=document.createAttribute("name");atr.nodeValue="Next-page";span.setAttributeNode(atr);ul.parentNode.appendChild(span)}else{if(parseInt(curPage+1)<=parseInt(pageTotal)){that.removeClass(obj,'disabled')}else{for(var i=0;i<number.length;i+=1){var lastm=parseInt(number[i].getAttribute("data-pages"));if(curPage==lastm){that.addClass(number[i],'active')}}that.addClass(obj,'disabled')}}},showPageTotal:function(ul,curPage,pageTotal,total,Table){var that=this;var totalPage=that.getByClass(ul.parentNode,'totalPage');if(totalPage==0){var span1=TABLAYER$('span');span1.innerHTML='每页：<select class="select-page" name="SelectPage"></select> 条';span1.className='select-page';ul.parentNode.appendChild(span1);var span2=TABLAYER$('span');span2.innerHTML='共&nbsp'+pageTotal+'&nbsp页';span2.className='totalPage';var pages=document.createAttribute("name");pages.nodeValue='pageTotal';span2.setAttributeNode(pages);ul.parentNode.appendChild(span2);var span3=TABLAYER$('span');span3.innerHTML='合计&nbsp'+total+'&nbsp条';span3.className='totalPage';var pages1=document.createAttribute("name");pages1.nodeValue='total';span3.setAttributeNode(pages1);ul.parentNode.appendChild(span3);that.selectPage(curPage,pageTotal,total,Table)}else{for(var i=0;i<totalPage.length;i+=1){var num=totalPage[i].getAttribute('name');if(num=='pageTotal'){totalPage[i].innerHTML='共&nbsp'+pageTotal+'&nbsp页'}if(num=='total'){totalPage[i].innerHTML='合计&nbsp'+total+'&nbsp条'}}}},selectPage:function(curPage,pageTotal,total,Table){var that=this;var name=name$('SelectPage')[0];var size=that.par.pageSize;for(var i=0;i<size.length;i+=1){name.innerHTML+="<option value="+size[i]+">"+size[i]+"</option>"}var pageSize=size[0];name.onchange=function(){var pageSize=parseInt(name.options[name.selectedIndex].value);that.par.Callback(Table,that,curPage,pageSize)}},finalPage:function(ul,curPage,pageTotal,html){var that=this;var Table=TAB$(that.par.TableName);var span=TABLAYER$('span');var number=name$('page-number');var size=that.par.pageSize;var pageSize=size[0];span.innerHTML='尾页';ul.parentNode.appendChild(span);var pagination=TAB$(that.par.paginName);span.onclick=function(){var curPage=parseInt(pageTotal);that.getPage(curPage);that.par.Callback(Table,that,curPage,pageSize);that.addClass(span,'active');for(var i=0;i<number.length;i+=1){that.removeClass(number[i],'active')}var Pre=name$('Pre-page')[0];that.lastPage(ul,curPage,html,Pre);var next=name$('Next-page')[0];that.nextPage(ul,curPage,pageTotal,html,next);};var atr=document.createAttribute("name");atr.nodeValue="last-page";span.setAttributeNode(atr)},onSequence:function(Table,col){var _this=this;var SortAsNumber=true;var Sorter=[];for(var x=1;x<Table.rows.length;x+=1){Sorter[x-1]=[Table.rows[x].cells[col].innerHTML,x];SortAsNumber=SortAsNumber&&_this.IsNumeric(Sorter[x-1][0])}if(SortAsNumber){for(var x=0;x<Sorter.length;x+=1){for(var y=x+1;y<Sorter.length;y+=1){if(parseFloat(Sorter[y][0])<parseFloat(Sorter[x][0])){var tmp=Sorter[x];Sorter[x]=Sorter[y];Sorter[y]=tmp}}}}else{Sorter.sort()}if(_this.par.ViewState[col]){Sorter.reverse();_this.par.ViewState[col]=false;_this.addClass(Table.rows[0].cells[col].lastChild,'SortDescCss')}else{_this.par.ViewState[col]=true;_this.removeClass(Table.rows[0].cells[col].lastChild,'SortAscCss')}var Rank=[];for(var x=0;x<Sorter.length;x+=1){Rank[x]=_this.GetRowHtml(Table.rows[Sorter[x][1]])}for(var x=1;x<Table.rows.length;x+=1){for(var y=0;y<Table.rows[x].cells.length;y+=1){Table.rows[x].cells[y].innerHTML=Rank[x-1][y]}}_this.OnSorted(Table.rows[0].cells[col],_this.par.ViewState[col])},onlikecheck:function(Table,col){var table=this;for(var x=0;x<Table.rows[0].cells.length;x+=1){var checkbox=Table.rows[0].cells[x].getElementsByTagName('input')[x];if(checkbox){if(checkbox.checked==true){checkbox?checkbox.checked=false:''}}var zcheckbox=Table.rows[col].cells[0].getElementsByTagName('input')[x];if(zcheckbox){if(zcheckbox.checked==true){table.addClass(Table.rows[col],'active');}else{Table.rows[col].className=""}for(var x=1;x<Table.rows.length;x+=1){var n=Table.querySelectorAll(".active").length;var t=Table.rows.length-1;if(n==t){checkbox?checkbox.checked=true:''}}}}},oncheckbox:function(Table,col){for(var x=1;x<Table.rows.length;x+=1){var checkbox=Table.rows[x].cells[col].getElementsByTagName('input')[col];for(var y=0;y<Table.rows[0].cells.length;y+=1){var checkboxs=Table.rows[0].cells[y].getElementsByTagName('input')[y];if(checkboxs){if(checkboxs.checked==false){checkbox?checkbox.checked=false:'';Table.rows[x].className=""}else{checkbox.checked=true;Table.rows[x].className="active"}}}}},Dragdrop:function(e,Table,tTD,obj){var col=obj.cellIndex;var tTD=Table.rows[0].cells[col];if(e.offsetX>tTD.offsetWidth-10){tTD.mouseDown=true;tTD.oldX=e.x;tTD.oldWidth=tTD.offsetWidth}},onmouseupDrop:function(e,Table,tTD,obj){var col=obj.cellIndex;if(tTD==undefined){tTD=Table.rows[0].cells[col]}tTD.mouseDown=false;tTD.style.cursor='default'},onmousemoveDrop:function(e,Table,tTD,obj){var col=obj.cellIndex;if(e.offsetX>Table.rows[0].cells[col].offsetWidth-5){Table.rows[0].cells[col].style.cursor='e-resize'}else{Table.rows[0].cells[col].style.cursor='default'}if(tTD==undefined){tTD=Table.rows[0].cells[col]}if(tTD.mouseDown!=null&&tTD.mouseDown==true){tTD.style.cursor='default';if(tTD.oldWidth+(e.x-tTD.oldX)>0){tTD.width=tTD.oldWidth+(e.x-tTD.oldX)}tTD.style.width=tTD.width;tTD.style.cursor='e-resize';table=tTD;while(table.tagName!='TABLE'){table=table.parentElement}for(j=0;j<table.rows.length;j+=1){table.rows[j].cells[tTD.cellIndex].width=tTD.width}}},GetRowHtml:function(row){var result=[];for(var x=0;x<row.cells.length;x+=1){result[x]=row.cells[x].innerHTML}return result},OnSorted:function(cell,IsAsc){return},IsNumeric:function(num){return/^\d+(\.\d+)?$/.test(num)}};